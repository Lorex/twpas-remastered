<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FHIR è½‰æ› - TWPAS</title>
  <link rel="stylesheet" href="/shared.css">
  <style>
    /* Page-specific styles */
    .btn {
      padding: 0.6rem 1.5rem;
      border-radius: var(--radius-md);
      cursor: pointer;
      border: none;
      font-size: var(--font-size-base);
    }
    .btn-success {
      background: var(--color-approved-text);
      color: white;
    }
    .code-block {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: var(--spacing-lg);
      border-radius: var(--radius-md);
      font-family: 'Consolas', monospace;
      font-size: var(--font-size-sm);
      overflow-x: auto;
      max-height: 400px;
      overflow-y: auto;
    }
    .result-section {
      margin-top: var(--spacing-lg);
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>ğŸ¥ TWPAS ç™Œç—‡ç”¨è—¥äº‹å‰å¯©æŸ¥ç³»çµ±</h1>
    <div class="header-right">
      <span class="user-badge" id="user-role-badge"></span>
      <span id="username-display"></span>
      <button class="logout-btn" onclick="logout()">ç™»å‡º</button>
    </div>
  </header>

  <nav class="sidebar">
    <ul class="sidebar-menu">
      <li><a href="/dashboard"><span>ğŸ“Š</span> å„€è¡¨æ¿</a></li>
      <div class="menu-divider"></div>
      <div class="menu-label">æ¡ˆä»¶ç®¡ç†</div>
      <li><a href="/claim/new"><span>â•</span> æ–°å¢ç”³è«‹</a></li>
      <li><a href="/claim"><span>ğŸ“‹</span> æ¡ˆä»¶åˆ—è¡¨</a></li>
      <div class="menu-divider"></div>
      <div class="menu-label">è³‡æ–™ç®¡ç†</div>
      <li><a href="/patient"><span>ğŸ‘¤</span> ç—…æ‚£è³‡æ–™</a></li>
      <li><a href="/valueset"><span>ğŸ“š</span> å€¼é›†ç®¡ç†</a></li>
      <div class="menu-divider"></div>
      <div class="menu-label">ç³»çµ±åŠŸèƒ½</div>
      <li><a href="/fhir" class="active"><span>ğŸ”„</span> FHIR è½‰æ›</a></li>
      <li><a href="/nhi-upload"><span>â˜ï¸</span> å¥ä¿ä¸Šå‚³</a></li>
    </ul>
  </nav>

  <main class="main">
    <div class="page-header">
      <h2>ğŸ”„ FHIR R4 è½‰æ›å·¥å…·</h2>
    </div>

    <div class="card">
      <div class="card-header">é¸æ“‡æ¡ˆä»¶è½‰æ›ç‚º FHIR Bundle</div>
      <div class="card-body">
        <div class="form-group">
          <label>é¸æ“‡æ¡ˆä»¶</label>
          <select id="case-select">
            <option value="">è«‹é¸æ“‡æ¡ˆä»¶...</option>
            <option value="1">CL-2026-0001 - ç‹â—‹æ˜ - Pembrolizumab</option>
            <option value="2">CL-2026-0002 - æâ—‹è¯ - Nivolumab</option>
            <option value="3">CL-2026-0003 - å¼µâ—‹æˆ - Atezolizumab</option>
          </select>
        </div>
        <button class="btn btn-primary" onclick="convertToFHIR()">ğŸ”„ è½‰æ›ç‚º FHIR</button>
        <button class="btn btn-success" onclick="validateFHIR()">âœ“ é©—è­‰ FHIR</button>
      </div>
    </div>

    <div class="card result-section" id="result-card" style="display: none;">
      <div class="card-header">FHIR Bundle è¼¸å‡º</div>
      <div class="card-body">
        <div class="code-block" id="fhir-output"></div>
      </div>
    </div>
  </main>

  <script src="/shared.js"></script>
  <script>
    const sampleFHIR = {
      resourceType: "Bundle",
      type: "collection",
      timestamp: new Date().toISOString(),
      entry: [
        {
          fullUrl: "urn:uuid:patient-001",
          resource: {
            resourceType: "Patient",
            identifier: [{ system: "urn:oid:2.16.886.101.20003.20014", value: "A123***789" }],
            name: [{ text: "ç‹â—‹æ˜" }],
            gender: "male",
            birthDate: "1965-03-15"
          }
        },
        {
          fullUrl: "urn:uuid:claim-001",
          resource: {
            resourceType: "Claim",
            status: "draft",
            type: { coding: [{ system: "http://terminology.hl7.org/CodeSystem/claim-type", code: "professional" }] },
            use: "preauthorization",
            patient: { reference: "urn:uuid:patient-001" },
            created: "2026-02-02",
            provider: { display: "ç‹å¤§æ˜é†«å¸«" }
          }
        }
      ]
    };

    function convertToFHIR() {
      const caseId = document.getElementById('case-select').value;
      if (!caseId) {
        alert('è«‹é¸æ“‡æ¡ˆä»¶');
        return;
      }
      document.getElementById('result-card').style.display = 'block';
      document.getElementById('fhir-output').textContent = JSON.stringify(sampleFHIR, null, 2);
    }

    function validateFHIR() {
      alert('FHIR é©—è­‰é€šéï¼\n\n- Bundle çµæ§‹æ­£ç¢º\n- å¿…å¡«æ¬„ä½å®Œæ•´\n- åƒç…§å®Œæ•´æ€§æª¢æŸ¥é€šé');
    }

    displayUserInfo();
  </script>
</body>
</html>
