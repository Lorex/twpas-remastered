# language: zh-TW
@claim @query
功能: 申請案件查詢
  作為一個醫療人員
  我想要能夠依據多種條件查詢申請案件
  以便快速找到需要處理的案件

  背景:
    假設 我已經登入為 "doctor01"
    並且 資料庫中存在以下申請案件:
      | 申請類別 | 申請次數 | 病歷號  | 姓名     | 身份證字號   | 疾病別 | 申請藥品               | 申請日期   | 影像學檢查 | 狀態     |
      | 送核     | 1        | 1234567 | 測試病人 | E125123456   | G009   | Herceptin SC           | 2025-09-23 | 2026-02-02 | 草稿     |
      | 送核     | 2        | 1234567 | 測試病人 | E125123456   | G009   | Kadcyla                | 2025-10-15 | 2025-10-10 | 待審核   |
      | 補件     | 1        | 2345678 | 王小明   | A123456789   | G010   | Perjeta                | 2025-11-01 | 2025-10-28 | 送審中   |
      | 申復     | 1        | 3456789 | 李小華   | B234567890   | G009   | Trastuzumab            | 2025-08-15 | 2025-08-10 | 通過     |
      | 送核     | 3        | 4567890 | 張大同   | C345678901   | G011   | Phesgo                 | 2025-07-20 | 2025-07-18 | 未通過   |

  # =============================================================================
  # 申請案件管理頁面結構
  # =============================================================================

  @page-structure
  場景: 顯示申請案件管理頁面
    當 我在申請案件管理頁面
    那麼 我應該看到頁面標題 "申請案件管理"
    並且 我應該看到進階篩選區塊
    並且 我應該看到狀態標籤頁

  場景: 顯示狀態標籤頁
    當 我在申請案件管理頁面
    那麼 我應該看到以下狀態標籤頁:
      | 標籤頁     |
      | 草稿       |
      | 待審核     |
      | 送審中     |
      | 通過       |
      | 未通過     |
      | 爭審       |
      | 續件提醒   |
      | 結案       |

  場景: 預設顯示草稿標籤頁
    當 我在申請案件管理頁面
    那麼 草稿標籤頁應該為選中狀態
    並且 我應該看到草稿狀態的案件列表

  # =============================================================================
  # 申請類別篩選
  # =============================================================================

  @filter-by-type
  場景大綱: 依申請類別篩選
    當 我在申請案件管理頁面
    並且 我勾選申請類別篩選 "<類別>"
    並且 我點擊查詢按鈕
    那麼 查詢結果應該只包含申請類別為 "<類別>" 的案件

    例子:
      | 類別       |
      | 送核       |
      | 補件       |
      | 申復       |
      | 爭議審議   |
      | 資料異動   |

  場景: 多選申請類別篩選
    當 我在申請案件管理頁面
    並且 我勾選申請類別篩選 "送核"
    並且 我勾選申請類別篩選 "補件"
    並且 我點擊查詢按鈕
    那麼 查詢結果應該包含申請類別為 "送核" 或 "補件" 的案件

  # =============================================================================
  # 基本條件篩選
  # =============================================================================

  @basic-filter
  場景: 依病歷號查詢
    當 我在申請案件管理頁面
    並且 我在病歷號欄位輸入 "1234567"
    並且 我點擊查詢按鈕
    那麼 查詢結果應該只包含病歷號為 "1234567" 的案件

  場景: 依身份證字號查詢
    當 我在申請案件管理頁面
    並且 我在身份證字號欄位輸入 "E125123456"
    並且 我點擊查詢按鈕
    那麼 查詢結果應該只包含身份證字號為 "E125123456" 的案件

  場景: 依姓名查詢
    當 我在申請案件管理頁面
    並且 我在姓名欄位輸入 "測試病人"
    並且 我點擊查詢按鈕
    那麼 查詢結果應該只包含姓名為 "測試病人" 的案件

  場景: 依疾病別篩選
    當 我在申請案件管理頁面
    並且 我在疾病別下拉選單選擇 "G009"
    並且 我點擊查詢按鈕
    那麼 查詢結果應該只包含疾病別為 "G009" 的案件

  場景: 依申請藥品篩選
    當 我在申請案件管理頁面
    並且 我在申請藥品下拉選單選擇 "Herceptin SC"
    並且 我點擊查詢按鈕
    那麼 查詢結果應該只包含申請藥品為 "Herceptin SC" 的案件

  # =============================================================================
  # 日期範圍篩選
  # =============================================================================

  @date-filter
  場景: 依影像學檢查日期範圍查詢
    當 我在申請案件管理頁面
    並且 我設定影像學檢查日期起為 "2025-10-01"
    並且 我設定影像學檢查日期迄為 "2025-10-31"
    並且 我點擊查詢按鈕
    那麼 查詢結果應該只包含影像學檢查日期在該範圍內的案件

  場景: 依申請日期範圍查詢
    當 我在申請案件管理頁面
    並且 我設定申請日期起為 "2025-09-01"
    並且 我設定申請日期迄為 "2025-09-30"
    並且 我點擊查詢按鈕
    那麼 查詢結果應該只包含申請日期在該範圍內的案件

  場景: 只設定日期起始條件
    當 我在申請案件管理頁面
    並且 我設定申請日期起為 "2025-10-01"
    並且 我點擊查詢按鈕
    那麼 查詢結果應該包含申請日期在 "2025-10-01" 之後的所有案件

  場景: 只設定日期結束條件
    當 我在申請案件管理頁面
    並且 我設定申請日期迄為 "2025-10-31"
    並且 我點擊查詢按鈕
    那麼 查詢結果應該包含申請日期在 "2025-10-31" 之前的所有案件

  # =============================================================================
  # 複合條件查詢
  # =============================================================================

  @compound-filter
  場景: 複合條件查詢 - 申請類別和姓名
    當 我在申請案件管理頁面
    並且 我勾選申請類別篩選 "送核"
    並且 我在姓名欄位輸入 "測試病人"
    並且 我點擊查詢按鈕
    那麼 查詢結果應該只包含同時符合兩個條件的案件

  場景: 複合條件查詢 - 多個條件
    當 我在申請案件管理頁面
    並且 我設定以下查詢條件:
      | 條件           | 值           |
      | 申請類別       | 送核         |
      | 疾病別         | G009         |
      | 申請藥品       | Herceptin SC |
    並且 我點擊查詢按鈕
    那麼 查詢結果應該只包含符合所有條件的案件

  # =============================================================================
  # 狀態標籤頁切換
  # =============================================================================

  @status-tabs
  場景: 切換到待審核標籤頁
    當 我在申請案件管理頁面
    並且 我點擊 "待審核" 標籤頁
    那麼 我應該看到狀態為 "待審核" 的案件列表
    並且 列表應該包含案件 "Kadcyla"

  場景: 切換到送審中標籤頁
    當 我在申請案件管理頁面
    並且 我點擊 "送審中" 標籤頁
    那麼 我應該看到狀態為 "送審中" 的案件列表

  場景: 切換到通過標籤頁
    當 我在申請案件管理頁面
    並且 我點擊 "通過" 標籤頁
    那麼 我應該看到狀態為 "通過" 的案件列表

  場景: 切換到未通過標籤頁
    當 我在申請案件管理頁面
    並且 我點擊 "未通過" 標籤頁
    那麼 我應該看到狀態為 "未通過" 的案件列表

  場景: 切換到續件提醒標籤頁
    當 我在申請案件管理頁面
    並且 我點擊 "續件提醒" 標籤頁
    那麼 我應該看到需要續件的案件列表

  場景: 切換到結案標籤頁
    當 我在申請案件管理頁面
    並且 我點擊 "結案" 標籤頁
    那麼 我應該看到已結案的案件列表

  # =============================================================================
  # 快速搜尋
  # =============================================================================

  @quick-search
  場景: 使用快速搜尋
    當 我在申請案件管理頁面
    並且 我在快速搜尋欄位輸入 "測試病人"
    那麼 列表應該即時篩選顯示符合條件的案件

  場景: 快速搜尋支援多欄位
    當 我在申請案件管理頁面
    並且 我在快速搜尋欄位輸入 "1234567"
    那麼 列表應該顯示病歷號包含 "1234567" 的案件

  # =============================================================================
  # 清除篩選
  # =============================================================================

  @clear-filter
  場景: 清除所有篩選條件
    當 我在申請案件管理頁面
    並且 我設定多個篩選條件
    並且 我點擊 "清除" 按鈕
    那麼 所有篩選條件應該被清除
    並且 應該顯示所有案件

  # =============================================================================
  # 案件列表顯示
  # =============================================================================

  @list-display
  場景: 案件列表欄位顯示
    當 我在申請案件管理頁面
    那麼 案件列表應該顯示以下欄位:
      | 欄位         |
      | 申請類別     |
      | 申請次數     |
      | 病歷號       |
      | 姓名         |
      | 身份證字號   |
      | 疾病別       |
      | 申請藥品     |
      | 申請日期     |
      | 影像學檢查   |
      | 建立日期     |

  場景: 案件列表操作按鈕
    當 我在申請案件管理頁面
    那麼 每筆案件應該有 "編輯" 按鈕
    並且 草稿案件應該有 "刪除" 按鈕

  # =============================================================================
  # 分頁
  # =============================================================================

  @pagination
  場景: 顯示分頁控制
    假設 資料庫中存在超過一頁的案件
    當 我在申請案件管理頁面
    那麼 我應該看到分頁控制項

  場景: 切換分頁
    假設 資料庫中存在超過一頁的案件
    當 我在申請案件管理頁面
    並且 我點擊第 2 頁
    那麼 應該顯示第二頁的案件

  # =============================================================================
  # 查詢無結果
  # =============================================================================

  @no-results
  場景: 查詢無結果
    當 我在申請案件管理頁面
    並且 我在病歷號欄位輸入 "NOTEXIST"
    並且 我點擊查詢按鈕
    那麼 案件列表應該為空

  場景: 空的狀態標籤頁
    當 我在申請案件管理頁面
    並且 我點擊 "爭審" 標籤頁
    假設 沒有爭審狀態的案件
    那麼 案件列表應該為空
