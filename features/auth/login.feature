# language: zh-TW
@auth @login
功能: 使用者登入
  作為一個系統使用者
  我想要能夠登入系統
  以便存取事前審查相關功能

  背景:
    假設 系統已經啟動
    並且 資料庫中存在以下使用者:
      | 帳號          | 密碼           | 姓名   | 科別   | 狀態   |
      | TWPASTWPAS    | TWPASTWPAS     | 洪主任 | 乳癌   | 啟用   |
      | doctor01      | Pass1234!      | 張醫師 | 腫瘤科 | 啟用   |
      | inactive_user | Pass1234!      | 王護理師 | 護理部 | 停用 |

  # =============================================================================
  # 登入頁面結構
  # =============================================================================

  @page-structure
  場景: 顯示登入頁面
    當 我在登入頁面
    那麼 我應該看到頁面標題包含 "TWPAS"
    並且 我應該看到帳號輸入欄位
    並且 我應該看到密碼輸入欄位
    並且 我應該看到登入按鈕

  場景: 登入表單欄位標籤
    當 我在登入頁面
    那麼 帳號欄位應該有標籤 "* 帳號:"
    並且 密碼欄位應該有標籤 "* 密碼:"

  # =============================================================================
  # 成功登入
  # =============================================================================

  @happy-path
  場景: 使用有效帳號密碼登入
    當 我在登入頁面
    並且 我輸入帳號 "TWPASTWPAS"
    並且 我輸入密碼 "TWPASTWPAS"
    並且 我點擊登入按鈕
    那麼 我應該看到個人資料頁面
    並且 我應該看到歡迎訊息包含 "洪主任"
    並且 系統應該記錄登入日誌

  場景: 登入後顯示側邊選單
    假設 我已經登入為 "TWPASTWPAS"
    那麼 我應該看到以下側邊選單項目:
      | 選單項目       |
      | 病人資料管理   |
      | 個人資料       |
      | 新增申請案     |
      | 申請案件管理   |
      | Logout         |

  # =============================================================================
  # 登入失敗
  # =============================================================================

  @error-handling
  場景: 使用錯誤密碼登入
    當 我在登入頁面
    並且 我輸入帳號 "TWPASTWPAS"
    並且 我輸入密碼 "WrongPassword"
    並且 我點擊登入按鈕
    那麼 我應該看到錯誤訊息 "帳號或密碼錯誤"
    並且 我應該仍在登入頁面

  場景: 使用不存在的帳號登入
    當 我在登入頁面
    並且 我輸入帳號 "nonexistent_user"
    並且 我輸入密碼 "Pass1234!"
    並且 我點擊登入按鈕
    那麼 我應該看到錯誤訊息 "帳號或密碼錯誤"
    並且 我應該仍在登入頁面

  場景: 使用停用帳號登入
    當 我在登入頁面
    並且 我輸入帳號 "inactive_user"
    並且 我輸入密碼 "Pass1234!"
    並且 我點擊登入按鈕
    那麼 我應該看到錯誤訊息 "帳號已停用，請聯繫管理員"
    並且 我應該仍在登入頁面

  場景: 空白帳號或密碼登入
    當 我在登入頁面
    並且 我輸入帳號 ""
    並且 我輸入密碼 ""
    並且 我點擊登入按鈕
    那麼 我應該看到錯誤訊息 "請輸入帳號和密碼"

  場景: 只輸入帳號不輸入密碼
    當 我在登入頁面
    並且 我輸入帳號 "TWPASTWPAS"
    並且 我輸入密碼 ""
    並且 我點擊登入按鈕
    那麼 我應該看到錯誤訊息提示密碼為必填

  場景: 只輸入密碼不輸入帳號
    當 我在登入頁面
    並且 我輸入帳號 ""
    並且 我輸入密碼 "TWPASTWPAS"
    並且 我點擊登入按鈕
    那麼 我應該看到錯誤訊息提示帳號為必填

  # =============================================================================
  # 登出
  # =============================================================================

  @logout
  場景: 成功登出
    假設 我已經登入為 "TWPASTWPAS"
    當 我點擊 "Logout" 連結
    那麼 我應該被導向登入頁面
    並且 系統應該記錄登出日誌

  # =============================================================================
  # 安全性
  # =============================================================================

  @security
  場景: 連續登入失敗後鎖定帳號
    當 我在登入頁面
    並且 我使用錯誤密碼嘗試登入 "TWPASTWPAS" 連續 5 次
    那麼 我應該看到錯誤訊息 "帳號已被鎖定，請在 15 分鐘後重試"
    並且 該帳號應該被暫時鎖定 15 分鐘

  場景: 登入後閒置超時
    假設 我已經登入為 "TWPASTWPAS"
    當 系統閒置超過 30 分鐘
    並且 我嘗試存取任何頁面
    那麼 我應該被重導到登入頁面
    並且 我應該看到訊息 "您的登入已過期，請重新登入"

  場景: 密碼欄位顯示/隱藏切換
    當 我在登入頁面
    並且 我輸入密碼 "TestPassword"
    那麼 密碼應該以遮罩方式顯示
    當 我點擊密碼顯示/隱藏切換按鈕
    那麼 密碼應該以明文方式顯示

  # =============================================================================
  # 未授權存取
  # =============================================================================

  @authorization
  場景: 未登入存取受保護頁面
    當 我未登入
    並且 我嘗試存取病人資料管理頁面
    那麼 我應該被重導到登入頁面

  場景: 未登入存取申請案件管理頁面
    當 我未登入
    並且 我嘗試存取申請案件管理頁面
    那麼 我應該被重導到登入頁面
